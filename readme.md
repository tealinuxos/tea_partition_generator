# Tea partition generator

this is a json auto generator & backend autopartitioning for tealinux installer, here what you should know

- `./src/dual_boot_blockdev.rs` contains various function and helper that will called after user click next on partitioning page (only for dualboot section).
- `./src/single_boot_blockdev.rs` same as dualboot, but this is will overwrite entire disk.
- `./src/os.rs` contains various helper functions
- `./src/mkpart.rs` a set of helper function that execute `parted` command & partition utility
- `./src/mounting.rs` helper that help you mount the partition, note: you must mount root first then /boot, not vice versa.
- `./src/core.rs`, is a helper function collection
- `./src/parted_parser.rs`, is a machine parted reader.
- `./src/dual_boot_efi_mount.rs`, this file find & locate original EFI partition inside your disk & mount it.

# tunning
see `config.rs`

- MINIMUM_DISK_SIZE: this is a minimum required disks for installer to be working correctly.

# todo/fix

- fixme: remove all dangerous unwrap() in future (help need)
- todo: add custom partition install, example: user can select /dev/sda8 instead.
- todo: remove autogenerated_mode
- fixme: bug during installation, when some partition fs is unknown
- add support for NVME

# Notes
- please uncomment this section, os-prober related. this section used as testing. [link](https://github.com/tealinuxos/tea_partition_generator/blob/ff2dba336d5625f54282cfe21e263987367b7576/src/os.rs#L74-L82)
- `./bin` directory is a testing folder, use `sudo -E cargo run --bin <program_name>`
- if you searching about `blueprint.rs` struct signature conversion, the file is available [here](https://github.com/tealinuxos/tealinux-installer/blob/master/src-tauri/src/utils/tea_partition_generator_convert.rs).

# Test

here qemu test script & result
## MBR
```sh
qemu-system-x86_64 \
                      -enable-kvm \
                      -boot order=d \
                      -drive file=windows-tealinux-mbr.img,format=qcow2 \
                      -m 4G \
                      -enable-kvm \
                      -smp 4 \
                      -net user,hostfwd=tcp::20022-:22 \
                       -net nic
```

## result

| date | first_os                | secondary_os | ptable/boot_mode | type | fs  | swap | note |
|------|-------------------------|--------------|------------------|------|-----|------|------|
|25 may|Windows 10               |Tealinux      |mbr/bios          |dual  |ext4 |no    |success, but fastboot should be turned off, or BSOD|
|25 may|Windows 10               |Tealinux      |mbr/bios          |dual  |ext4 |yes   |untested, no partition left for swap|
|25 may|Windows 10               |Tealinux      |mbr/bios          |dual  |btrfs|no    |success, fastboot disabled|
|25 may|Windows 10               |Tealinux      |mbr/bios          |dual  |btrfs|yes   |untested, no partition left for swap|
|30 may|Windows 10               |Tealinux      |gpt/uefi          |dual  |ext4 |no    |tealinux success, but windows somewhat blank white & random line|
|  -   |Windows 10               |Tealinux      |gpt/uefi          |dual  |ext4 |yes   |on-progress|
|  -   |Windows 10               |Tealinux      |gpt/uefi          |dual  |btrfs|no    |on-progress|
|  -   |Windows 10               |Tealinux      |gpt/uefi          |dual  |btrfs|yes   |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |mbr/bios          |dual  |ext4 |no    |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |mbr/bios          |dual  |ext4 |yes   |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |mbr/bios          |dual  |btrfs|no    |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |mbr/bios          |dual  |btrfs|yes   |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |gpt/uefi          |dual  |ext4 |no    |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |gpt/uefi          |dual  |ext4 |yes   |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |gpt/uefi          |dual  |btrfs|no    |on-progress|
|  -   |Archlinux (by calamares) |Tealinux      |gpt/uefi          |dual  |btrfs|yes   |on-progress|
|  -   |Tealinux                 | -            |mbr/bios          |single|ext4 |no    |need re-tested|
|  -   |Tealinux                 | -            |mbr/bios          |single|ext4 |yes   |need re-tested|
|  -   |Tealinux                 | -            |mbr/bios          |single|btrfs|no    |need re-tested|
|  -   |Tealinux                 | -            |mbr/bios          |single|ext4 |yes   |need re-tested|
|  -   |Tealinux                 | -            |gpt/uefi          |single|ext4 |no    |need re-tested|
|  -   |Tealinux                 | -            |gpt/uefi          |single|ext4 |yes   |untested|
|  -   |Tealinux                 | -            |gpt/uefi          |single|btrfs|no    |need re-tested|
|  -   |Tealinux                 | -            |gpt/uefi          |single|ext4 |yes   |untested|

# License
GPL 2.0
